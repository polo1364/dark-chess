# 象棋暗棋（翻翻棋）— Web 版

> 單檔可執行、支援手機與電腦、可雙人同機或人機對戰、含先手決定與「連吃」規則、可調 AI 強度。  
> 版本：v1.0 • 更新日期：2025-10-21

## ✨ 功能總覽
- **直式 4×8 棋盤**（半盤中國象棋），棋子隨機背面朝上。
- **先手決定機制**：彈窗可「我先 / AI 先 / 擲骰」。先手第一步 **必須翻子**，翻到的顏色即為持色（對手為相反色）。
- **操作方式**：
  - 點棋＝選擇；再次點同一格＝取消。
  - 點暗棋＝翻子。
  - 點空格＝移動一步（上下左右）。
  - 點敵棋（橘色高亮）＝吃子。
- **連吃規則**：吃子後若仍可吃，系統會高亮可續吃目標並顯示「結束連吃」按鈕。
- **炮吃子**：同行同列，中間 **恰一子作為屏**，不受階級限制；不吃時也只能 **移動一格**。
- **階級吃法**：將>士>象>車>馬>炮>兵；可吃同級或更小。
  - **特例**：兵可吃將；將 **不能** 吃兵。
- **勝負與和局**：
  - 消滅對方全部明棋即勝。
  - 一方無法行棋（所有暗棋已翻完且無合法移動）視為負。
  - 連續 **50 手** 無吃子或翻子自動和局。
- **顯示**：上下方各顯示玩家名字，**右側**則累積顯示自己吃到的棋。
- **AI 三段**：快速 / 強 / 專家（預設強）。人機對戰會自動輪到 AI 執行。

## 🗂 檔案結構
```
dark-chess-web/
├─ index.html   # 單檔即開即玩（含 CSS/JS）
└─ README.md    # 本說明文件
```

## 🚀 快速開始
1. 下載並解壓縮本專案（或直接打開 `index.html`）。  
2. 用瀏覽器開啟 `index.html`（Chrome / Edge / Safari / Firefox 皆可）。  
3. 按「擲骰決先手」或在彈窗內選擇「我先 / AI 先」。  
4. 先手第一步必須翻子；翻到的顏色即為你的陣營。

> **建議**：若要放到網路上分享，直接把整個資料夾上傳到 GitHub Pages / 任何靜態主機即可（本專案是純前端）。

## 🎮 操作與規則重點
- **選棋 / 取消**：點棋選中，再點一次取消。
- **翻子**：點任一未翻棋。
- **移動**：明棋只能 **水平或垂直** 移動一格；**炮** 不吃時也只移動一格。
- **吃子**：
  - 一般子需相鄰格，且階級 ≥ 目標（兵可吃將、將不能吃兵）。
  - **炮吃**：同行同列，中間剛好隔一子（可為暗或明），不受階級限制。
- **連吃**：吃到後若還可吃，持續高亮可吃目標；若要結束當回合，按「結束連吃」。
- **和局**：連續 50 手沒有「吃子」或「翻子」。

## 🧠 AI 設計（簡述）
- 生成所有可行動：**翻子 / 移動 / 吃子**。
- **啟發式評分**：物質價值（將 1000…兵 110）、機動性（可吃步數加權較高）、中心控制、暗棋資訊值。
- **搜尋**：強/專家模式採 **極大極小 + αβ 剪枝**，專家比強多一層深度。吃子時做一輪「**貪婪連吃**」模擬以加速評估。

## ⚙️ 參數與客製
開啟 `index.html` 可快速修改：
- **AI 強度**：預設 `強`（下拉切換），程式內對應 `aiLevel = 0/1/2`。
- **和局手數**：`MAX_QUIET = 50`。
- **棋子價值**（AI 評估用）：`PIECE_VALUES`。
- **連吃**：已內建；若想關閉可在 `doCapture()` 內移除 `legalCapturesFrom()` 的續吃檢查。
- **介面字樣 / 顏色**：CSS 變數位於樣式區塊 `:rootEllipsis`。

## 📱 相容性與手感
- **RWD**：以直式操作為主，寬度自動縮放（`min(96vw, 540px)`）。
- **觸控**：點一下選棋、再點目標完成移動/吃子；再次點選中棋取消選取。
- **字型**：優先使用「Noto Sans TC / 微軟正黑體」。

## 🧩 已知差異 / 變體說明
- 市面規則偶有差異，本版採你提出的玩法：
  - 移動一格；炮不吃時移動一格。
  - 兵可吃將，將不能吃兵。
  - 允許**連吃**（同一子在回合內可多次吃）。
- 若需改成**車/馬/炮按中國象棋走法**的變體，可擴充 `canCapture()` 與移動生成器。

## 🛠 開發筆記
- 純前端、無第三方框架；`index.html` 內含所有程式。
- 狀態物件 `state` 包含：`board/turn/selected/history/capturedR/capturedB/quiet/winner`。
- AI 可再升級：
  - Zobrist Hash + 轉置表
  - 更細緻的風險評估（反吃/夾擊）
  - Monte Carlo 翻子期望值估計

## ❓常見問題
- **Q：翻子會不會改變回合？**  
  A：翻子視為一步，**不改變顏色指派**；首翻才會決定雙方顏色，並由對手行動。
- **Q：為何炮只能走一步？**  
  A：依你的需求（手機操作更直覺），**不吃時** 炮只走一步；吃子規則維持「隔屏吃」。

## 📄 授權
MIT（保留作者與專案名稱即可自由使用／修改／再散布）。

---

> 作者：Elyndra（智慧之光的提示建築師）  
> 需求摘要：先手決定、直式棋盤、手機/電腦皆宜、吃子區在右側、點擊式操作、AI 要強、內建 50 手和局與連吃。
